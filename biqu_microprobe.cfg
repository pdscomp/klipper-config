## --- BIQU Microprobe Klipper configuration ---
# Not much different from a standard probe config. The
# main difference compared to most probes is to disable
# deactivating the probe (PROBE_UP) after each sample
#
# You can either copy pasta this directly or import
# into your config.yml using [include microprobe.cfg]
#
# Note: if you are changing from a bltouch or one of its
# clones, remove/comment out the [bltouch] config!
# That also includes any auto generated config stored
# at the bottom by the PROBE_CALIBRATE command
#
# Note: the current control and sensor pin values are
# configured for the 'BTT SKR E3 mini V2' controller 
# board. You may need to update these values depending
# on your controller board model.
#
# Update (2023-10-17): This config is configured for
# the V1 microprobe. V2 users must update the 
# polarity of the sensor pin in the config to be 
# pull-down (^!) not pull up (^)

[gcode_macro PROBE_DOWN]
gcode:
    SET_PIN PIN=probe_enable VALUE=1

[gcode_macro PROBE_UP]
gcode:
    SET_PIN PIN=probe_enable VALUE=0

[output_pin probe_enable]
#pin: PA1  # Set to the control pin on your board
pin: PB0  # Creality 4.2.2 Control Pin=PB0
value: 0

[gcode_button probe_sensor]
pin: ^!PB1
press_gcode:
    M118 E1 BIQU MicroProbe v2: SENSOR TOUCH
release_gcode:
    M118 E1 BIQU MicroProbe v2: SENSOR UNTOUCH

#[probe]
#pin: ^!PB1  # V2 user so ^!, Creality 4.4.2 Sensor Pin=PB1
#pin: ^PA7  # V2 user so ^!, Creality 4.4.2 Sensor Pin=PB1
#pin: ^!PB1  # V2 user so ^!, Creality 4.4.2 Sensor Pin=PB1
#pin: ^PC14  # NOTE FOR V2 users: Set this to ^!PC14 to set the low level trigger 
#deactivate_on_each_sample: False
#x_offset: -40
#y_offset: -35
#z_offset: 0.2 # Will be overridden when you do a PROBE_CALIBRATE
#samples: 2
#samples_tolerance: 0.05
#samples_tolerance_retries: 3
#activate_gcode:
#    PROBE_DOWN
#    G4 P500
#deactivate_gcode:
#    PROBE_UP

#[safe_z_home]
#home_xy_position: 117.5,117.5 # Center of Ender 3 print bed
##speed: 50
#speed: 10
#z_hop: 10                 # Moves Z up 10mm
#z_hop_speed: 10

[bed_mesh]
#speed: 100
speed: 50
horizontal_move_z: 5
#min_point: 10,10
#max_point: 230,230
mesh_min: 40,40
mesh_max: 200,200
#probe_count: 5,5
probe_count: 3,3
fade_start: 1.0
fade_end: 10.0
